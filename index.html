<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>QR入出庫記録</title>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
<h2>QR入出庫記録</h2>
<div id="reader" style="width:300px;"></div>
<p>ID: <span id="scanned-id">未読</span></p>
<label>入庫数: <input type="number" id="inQty"></label><br>
<label>出庫数: <input type="number" id="outQty"></label><br>
<button id="sendBtn">送信</button>
<p id="result"></p>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbw8MLPsyb872cf4zHVtcEJLI1CxvHaUyCXM4XiBQp1LnOIwGS84tQ0kPH4bZgfilkRJ/exec";

// QRコード読み取り
function onScanSuccess(decodedText) {
    document.getElementById("scanned-id").innerText = decodedText;
}

new Html5QrcodeScanner("reader", { fps: 10, qrbox: 200 })
    .render(onScanSuccess);

document.getElementById("sendBtn").addEventListener("click", () => {
    const id = document.getElementById("scanned-id").innerText;
    const inQty = document.getElementById("inQty").value;
    const outQty = document.getElementById("outQty").value;

    if (!id || id === "未読") {
        alert("先にQRコードを読み取ってください");
        return;
    }

    const url = `${GAS_URL}?id=${encodeURIComponent(id)}&in=${encodeURIComponent(inQty)}&out=${encodeURIComponent(outQty)}`;

    fetch(url)
      .then(res => res.text()) // JSONではなくtextで受け取る
      .then(txt => {
          document.getElementById("result").innerText = txt;
      })
      .catch(err => {
          document.getElementById("result").innerText = "通信エラー: " + err;
      });
});
</script>
</body>
</html>
